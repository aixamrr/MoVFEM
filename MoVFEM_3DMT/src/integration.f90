!     
! file:   integration.f90
! author: a1203315
!
! created on 23 november 2011, 1:37 pm
!

module integration

    use kind_param
    implicit none
    private:: get_intpoints, get_intweights, allocate_local_gq,f1,f2,f3,&
    int_param,int_edges,int_pts_wgt
    real(kind=double),dimension(3), private:: g_rw
    real(kind=double), dimension(:,:), allocatable, public ::i_rw, cve1, cve2, ve, gpml
    real(kind=double), dimension(:), allocatable, private:: gpx, gpy, gpz, wgx, wgy, wgz,wgt
    complex(kind=double), dimension(:,:), allocatable, private:: mf1,mf2, src
	integer, public::  i_gpx,i_gpy, i_gpz,i_gpt
    contains
    subroutine int_mem(X)
        integer, intent(inout)::X
        X=X+sizeof(g_rw)+sizeof(i_rw)+sizeof(cve1)+sizeof(cve2)+sizeof(ve)+sizeof(gpml)+sizeof(gpx)+sizeof(gpy)+&
        sizeof(gpz)+sizeof(wgx)+sizeof(wgy)+sizeof(wgz)+sizeof(wgt)+sizeof(mf1)+sizeof(mf2)+sizeof(src)+sizeof(i_gpx)*4
    end subroutine int_mem
    subroutine init_integration()
    	use problem, only: ndir
    	use v_fem, only: vf_me
    	use boundary_conds, only: dirichlet
    	implicit none
		if (vf_me.eq.12) then
			i_gpx=2;i_gpy=2; i_gpz=2
		else
			i_gpx=3;i_gpy=3; i_gpz=3	
		endif		
		call allocate_local_gq()
    	call get_intpoints()
        call get_intweights()

    	i_gpt=i_gpx*i_gpy*i_gpz
    	write(*,*)'integration points: ', i_gpt
    	if (.not.allocated(i_rw)) allocate(i_rw(i_gpt,4))
    	call int_pts_wgt()

    	if (.not.allocated(wgt)) allocate(wgt(i_gpt))
    	allocate(mf1(i_gpt,6),mf2(i_gpt,6))
    	if (ndir.gt.1) then
    		allocate(src(i_gpt*ndir,3))
    	else
    		allocate(src(i_gpt,3))
    	endif
    	allocate(cve1(i_gpt*vf_me,3), cve2(i_gpt*vf_me,3), ve(i_gpt*vf_me,3))
    	if (.not.dirichlet) then
    		allocate(gpml(i_gpt,3))
    	endif
    end subroutine init_integration
!--------------------------------------------------------------------------------
!--------------Get Integration Points, and Weights.------------------------------
!-------------Interpolate source, geomodels, and edges---------------------------
!--------------------------------------------------------------------------------
    subroutine int_elem_params()
    	use n_fem, only: nf_jacobian, nf_det, nf_j
    	use boundary_conds, only:dirichlet
        integer:: id

        wgt=0.d0; cve1=0.d0; cve2=0.d0; ve=0.d0
        src=cmplx(0.d0,0.d0); mf1=cmplx(0.d0,0.d0); mf2=cmplx(0.d0,0.d0)
		if (.not.dirichlet) gpml=0.d0

        do id=1,i_gpt
	        call nf_jacobian(i_rw(id,1),i_rw(id,2),i_rw(id,3))
	        wgt(id)=(nf_det(nf_j))*i_rw(id,4)
	        call int_param(id)
        end do
    end subroutine int_elem_params
    
	complex(kind=double) function alocal(im,jm)
		use geometry, only: omega
		implicit none
    	integer, intent(in):: im,jm
    	integer:: i

    	alocal=cmplx(0.d0,0.d0)
    	do i=1,i_gpt
            alocal=alocal+wgt(i)*(f1(i,im,jm, mf1(i,:),i_rw(i,1:3))+cmplx(0.d0,omega)*f2(i,im,jm, mf2(i,:),i_rw(i,1:3)))
    	end do
    end function alocal

    function blocal(im)
    	use problem, only: ndir,edir
    	implicit none
    	complex(kind=double), dimension(ndir):: blocal
    	integer, intent(in):: im
    	integer:: i

    	blocal=cmplx(0.d0,0.d0)
    	do i=1,i_gpt
    	    if (ndir.gt.1) then
    	        do edir=1,ndir
    	            blocal(edir)=blocal(edir)+wgt(i)*f3(im,i,i_rw(i,1:3))
                end do
    	    else
    	        blocal(1)=blocal(1)+wgt(i)*f3(im,i,i_rw(i,1:3))
    	    endif
    	end do

    end function blocal

    subroutine int_param(i)
    	use problem, only: p_source, ndir,edir, p_intmodels
    	use global_assembly, only: dirichlet
    	use boundary_conds, only: gpml_h,dirichlet
    	use n_fem, only: nf_ln, nf_re, nf_mn
    	implicit none
    	complex(kind=double), dimension(3,ndir)::t_src
    	integer, intent(in)::i
    	integer:: d,j

	    call p_intmodels(mf1(i,:),mf2(i,:),i_rw(i,1:3))
	    if (.not.dirichlet) then
            g_rw=0.d0
            do j=1,nf_mn
                g_rw(1)=g_rw(1)+nf_ln(j,i_rw(i,1),i_rw(i,2),i_rw(i,3))*nf_re(j,1)
                g_rw(2)=g_rw(2)+nf_ln(j,i_rw(i,1),i_rw(i,2),i_rw(i,3))*nf_re(j,2)
                g_rw(3)=g_rw(3)+nf_ln(j,i_rw(i,1),i_rw(i,2),i_rw(i,3))*nf_re(j,3)
            end do
            gpml(i,:)=gpml_h(g_rw(1:3))
        endif
		t_src=p_source(i_rw(i,1:3))
	    if (ndir.gt.1) then
	        do d=1,ndir
	            src(i+(d-1)*i_gpt,:)=t_src(:,d)
	        end do
	    else
	        src(i,:)=t_src(:,1)
	    endif
	    call int_edges(i)
    end subroutine int_param

    subroutine int_edges(i)
    	use v_fem, only: vf_me, vf_elem_curl, vf_elem_ve, vf_cve, vf_ve
    	implicit none
    	integer, intent(in)::i
    	integer:: j

		do j=1, vf_me
			call vf_elem_curl(j,i_rw(i,1:3))
			cve1(i+(j-1)*i_gpt,1:3)=vf_cve(1:3,1)
			cve2(i+(j-1)*i_gpt,1:3)=vf_cve(1:3,2)
			call vf_elem_ve(j,i_rw(i,1:3))
			ve(i+(j-1)*i_gpt,1:3)=vf_ve
		end do
    end subroutine int_edges

	real(kind=double) function f1(ig,im,jm,m,r)
		use problem, only: pe_sch
		use boundary_conds, only: dirichlet,gpml_h
		implicit none
		integer, intent(in):: im,jm,ig
		real(kind=double), dimension(3),intent(in):: r
		complex(kind=double),dimension(6),intent(in)::m
		real(kind=double), dimension(3,2)::cv1,cv2
		complex(kind=double), dimension(3):: h

		cv1(1:3,1)=cve1(ig+(im-1)*i_gpt,1:3)
		cv1(1:3,2)=cve2(ig+(im-1)*i_gpt,1:3)

		cv2(1:3,1)=cve1(ig+(jm-1)*i_gpt,1:3)
		cv2(1:3,2)=cve2(ig+(jm-1)*i_gpt,1:3)
		if (.not.dirichlet) then
			h=gpml(ig,:)
			f1=(h(1)*h(3)/h(2))*m(1)*cv1(1,1)*cv2(1,1)-(h(1))*m(1)*cv1(1,2)*cv2(1,1)-&
            (h(1))*m(1)*cv1(1,1)*cv2(1,2)+(h(1)*h(2)/h(3))*m(1)*cv1(1,2)*cv2(1,2)+&
            (h(1))*m(2)*cv1(1,1)*cv2(2,1)-(h(1)*h(2)/h(3))*m(2)*cv1(1,2)*cv2(2,1)-&
            (h(3))*m(2)*cv1(1,1)*cv2(2,2)+(h(2))*m(2)*cv1(1,2)*cv2(2,2)+&
            (h(3))*m(3)*cv1(1,1)*cv2(3,1)-(h(2))*m(3)*cv1(1,2)*cv2(3,1)-&
            (h(1)*h(3)/h(2))*m(3)*cv1(1,1)*cv2(3,2)+(h(1))*m(3)*cv1(1,2)*cv2(3,2)+&
            (h(1))*m(2)*cv1(2,1)*cv2(1,1)-(h(3))*m(2)*cv1(2,2)*cv2(1,1)-&
            (h(1)*h(2)/h(3))*m(2)*cv1(2,1)*cv2(1,2)+(h(2))*m(2)*cv1(2,2)*cv2(1,2)+&
            (h(1)*h(2)/h(3))*m(4)*cv1(2,1)*cv2(2,1)-h(2)*m(4)*cv1(2,2)*cv2(2,1)-&
            h(2)*m(4)*cv1(2,1)*cv2(2,2)+(h(2)*h(3)/h(1))*m(4)*cv1(2,2)*cv2(2,2)+&
            (h(2))*m(5)*cv1(2,1)*cv2(3,1)-(h(2)*h(3)/h(1))*m(5)*cv1(2,2)*cv2(3,1)-&
            h(1)*m(5)*cv1(2,1)*cv2(3,2)+h(3)*m(5)*cv1(2,2)*cv2(3,2)+&
            h(3)*m(3)*cv1(3,1)*cv2(1,1)-(h(1)*h(3)/h(2))*m(3)*cv1(3,2)*cv2(1,1)-&
            h(2)*m(3)*cv1(3,1)*cv2(1,2)+h(1)*m(3)*cv1(3,2)*cv2(1,2)+&
            h(2)*m(5)*cv1(3,1)*cv2(2,1)-h(1)*m(5)*cv1(3,2)*cv2(2,1)-&
            (h(2)*h(3)/h(1))*m(5)*cv1(3,1)*cv2(2,2)+h(3)*m(5)*cv1(3,2)*cv2(2,2)+&
            (h(2)*h(3)/h(1))*m(6)*cv1(3,1)*cv2(3,1)-h(3)*m(6)*cv1(3,2)*cv2(3,1)-&
            h(3)*m(6)*cv1(3,1)*cv2(3,2)+(h(1)*h(3)/h(2))*m(6)*cv1(3,2)*cv2(3,2)
		else
		    f1=m(1)*cv1(1,1)*cv2(1,1)-m(1)*cv1(1,2)*cv2(1,1)-&
            m(1)*cv1(1,1)*cv2(1,2)+m(1)*cv1(1,2)*cv2(1,2)+&
            m(2)*cv1(1,1)*cv2(2,1)-m(2)*cv1(1,2)*cv2(2,1)-&
            m(2)*cv1(1,1)*cv2(2,2)+m(2)*cv1(1,2)*cv2(2,2)+&
            m(3)*cv1(1,1)*cv2(3,1)-m(3)*cv1(1,2)*cv2(3,1)-&
            m(3)*cv1(1,1)*cv2(3,2)+m(3)*cv1(1,2)*cv2(3,2)+&
            m(2)*cv1(2,1)*cv2(1,1)-m(2)*cv1(2,2)*cv2(1,1)-&
            m(2)*cv1(2,1)*cv2(1,2)+m(2)*cv1(2,2)*cv2(1,2)+&
            m(4)*cv1(2,1)*cv2(2,1)-m(4)*cv1(2,2)*cv2(2,1)-&
            m(4)*cv1(2,1)*cv2(2,2)+m(4)*cv1(2,2)*cv2(2,2)+&
            m(5)*cv1(2,1)*cv2(3,1)-m(5)*cv1(2,2)*cv2(3,1)-&
            m(5)*cv1(2,1)*cv2(3,2)+m(5)*cv1(2,2)*cv2(3,2)+&
            m(3)*cv1(3,1)*cv2(1,1)-m(3)*cv1(3,2)*cv2(1,1)-&
            m(3)*cv1(3,1)*cv2(1,2)+m(3)*cv1(3,2)*cv2(1,2)+&
            m(5)*cv1(3,1)*cv2(2,1)-m(5)*cv1(3,2)*cv2(2,1)-&
            m(5)*cv1(3,1)*cv2(2,2)+m(5)*cv1(3,2)*cv2(2,2)+&
            m(6)*cv1(3,1)*cv2(3,1)-m(6)*cv1(3,2)*cv2(3,1)-&
            m(6)*cv1(3,1)*cv2(3,2)+m(6)*cv1(3,2)*cv2(3,2)
		endif
	end function f1

	real(kind=double) function f2(ig,im,jm,m,r)
		use problem, only: pe_sch
		use boundary_conds, only: dirichlet,gpml_h
		implicit none
		integer, intent(in):: im,jm,ig
		real(kind=double), dimension(3),intent(in):: r
		complex(kind=double),dimension(6),intent(in)::m
		real(kind=double), dimension(3)::cv1,cv2
		complex(kind=double), dimension(3):: h


		cv1=ve(ig+(im-1)*i_gpt,1:3)
		cv2=ve(ig+(jm-1)*i_gpt,1:3)

		if (.not.dirichlet) then
			h=gpml(ig,:)

			f2=h(1)*h(2)*h(3)*cv2(1)*m(1)*cv1(1)+h(1)*h(2)*h(3)*cv2(2)*m(2)*cv1(1)+&
			h(1)*h(2)*h(3)*cv2(3)*m(3)*cv1(1)+h(1)*h(2)*h(3)*cv2(1)*m(2)*cv1(2)+&
			h(1)*h(2)*h(3)*cv2(2)*m(4)*cv1(2)+h(1)*h(2)*h(3)*cv2(3)*m(5)*cv1(2)+&
            h(1)*h(2)*h(3)*cv2(1)*m(3)*cv1(3)+h(1)*h(2)*h(3)*cv2(2)*m(5)*cv1(3)+&
            h(1)*h(2)*h(3)*cv2(3)*m(6)*cv1(3)
		else
		    f2=(cv2(1)*m(1)*cv1(1)+cv2(2)*m(2)*cv1(1)+cv2(3)*m(3)*cv1(1))+&
            (cv2(1)*m(2)*cv1(2)+cv2(2)*m(4)*cv1(2)+cv2(3)*m(5)*cv1(2))+&
            (cv2(1)*m(3)*cv1(3)+cv2(2)*m(5)*cv1(3)+cv2(3)*m(6)*cv1(3))
		endif
	end function f2

	complex(kind=double) function f3(im,i,r)
		use boundary_conds, only: dirichlet,gpml_h
		use problem, only: ndir, edir
		implicit none
		integer, intent(in):: im,i
		real(kind=double),dimension(3), intent(in):: r
		complex(kind=double), dimension(3):: h
		integer:: j

		if (ndir.gt.1) then
			j=i+(edir-1)*i_gpt
		else
			j=i
		endif

		if (.not.dirichlet) then
			h=gpml(i,:)

			f3=h(1)*h(2)*h(3)*ve(i+(im-1)*i_gpt,1)*src(j,1)+&
			h(1)*h(2)*h(3)*ve(i+(im-1)*i_gpt,2)*src(j,2)+&
            h(1)*h(2)*h(3)*ve(i+(im-1)*i_gpt,3)*src(j,3)
		else
		    f3=ve(i+(im-1)*i_gpt,1)*src(j,1)+ve(i+(im-1)*i_gpt,2)*src(j,2)+&
		    ve(i+(im-1)*i_gpt,3)*src(j,3)
		endif
	end function f3

	subroutine int_pts_wgt()
		integer:: i1,j1,k1,id
		i_rw(1:i_gpx*i_gpy*i_gpz,1:4)=0.d0
		do i1=1,i_gpx
            do j1=1,i_gpy
                do k1=1,i_gpz
                    id=(i1-1)*i_gpy*i_gpz+(j1-1)*i_gpz+k1
                    i_rw(id,:)=(/gpx(i1),gpy(j1),gpz(k1),wgx(i1)*wgy(j1)*wgz(k1)/)
                end do
            end do
        end do
        deallocate(gpx,gpy,gpz,wgx,wgy,wgz)
	end subroutine int_pts_wgt
!--------------------------------------------------------------------------------
!--------------allocate local quadrature points and weights----------------------
!--------------------------------------------------------------------------------
    subroutine allocate_local_gq()
    	if (.not.allocated(gpx)) allocate(gpx(i_gpx)); if (.not.allocated(gpy)) allocate(gpy(i_gpy))
    	if (.not.allocated(gpz)) allocate(gpz(i_gpz)); if (.not.allocated(wgx)) allocate(wgx(i_gpx))
    	if (.not.allocated(wgy)) allocate(wgy(i_gpy)); if (.not.allocated(wgz)) allocate(wgz(i_gpz))
    end subroutine allocate_local_gq
!--------------------------------------------------------------------------------
!--------------get local quadrature points--------------------------------------
!--------------------------------------------------------------------------------
    subroutine get_intpoints()

        gpx(1:i_gpx)=0.d0; gpy(1:i_gpy)=0.d0; gpz(1:i_gpz)=0.d0

        select case(i_gpx)
            case(2)
                gpx=(/-0.577350269189625764509148780502,0.577350269189625764509148780502/)
            case(3)
                gpx=(/-0.774596669241483377035853079956,0.0,0.774596669241483377035853079956/)
            case(4)
                gpx=(/-0.861136311594052575223946488893,-0.339981043584856264802665759103,0.339981043584856264802665759103,&
                0.861136311594052575223946488893/)
            case(5)
                gpx=(/-0.906179845938663992797626878299,-0.538469310105683091036314420700,0.0,0.538469310105683091036314420700,&
                0.906179845938663992797626878299/)
            case(6)
                gpx=(/-0.932469514203152027812301554494,-0.661209386466264513661399595020,-0.238619186083196908630501721681,&
                0.238619186083196908630501721681,0.661209386466264513661399595020,0.932469514203152027812301554494/)
            case(7)
                gpx=(/-0.949107912342758524526189684048,-0.741531185599394439863864773281,-0.405845151377397166906606412077,&
                0.0,0.405845151377397166906606412077,0.741531185599394439863864773281,0.949107912342758524526189684048/)
            case(8)
                gpx=(/-0.960289856497536231683560868569,-0.796666477413626739591553936476,-0.525532409916328985817739049189,&
                -0.183434642495649804939476142360,0.183434642495649804939476142360,0.525532409916328985817739049189,&
                0.796666477413626739591553936476,0.960289856497536231683560868569/)
            case(9)
                gpx=(/-0.968160239507626089835576202904,-0.836031107326635794299429788070,-0.613371432700590397308702039341,&
                -0.324253423403808929038538014643,0.0,0.324253423403808929038538014643,0.613371432700590397308702039341,&
                0.836031107326635794299429788070,0.968160239507626089835576202904/)
            case(10)
                gpx=(/-0.973906528517171720077964012084,-0.865063366688984510732096688423,-0.679409568299024406234327365115,&
                -0.433395394129247190799265943166,-0.148874338981631210884626001130,0.148874338981631210884626001130,&
                0.433395394129247190799265943166,0.679409568299024406234327365115,0.865063366688984510732096688423,&
                0.973906528517171720077964012084/)
        end select

        select case(i_gpy)
            case(2)
                gpy=(/-0.577350269189625764509148780502,0.577350269189625764509148780502/)
            case(3)
                gpy=(/-0.774596669241483377035853079956,0.0,0.774596669241483377035853079956/)
            case(4)
                gpy=(/-0.861136311594052575223946488893,-0.339981043584856264802665759103,0.339981043584856264802665759103,&
                0.861136311594052575223946488893/)
            case(5)
                gpy=(/-0.906179845938663992797626878299,-0.538469310105683091036314420700,0.0,0.538469310105683091036314420700,&
                0.906179845938663992797626878299/)
            case(6)
                gpy=(/-0.932469514203152027812301554494,-0.661209386466264513661399595020,-0.238619186083196908630501721681,&
                0.238619186083196908630501721681,0.661209386466264513661399595020,0.932469514203152027812301554494/)
            case(7)
                gpy=(/-0.949107912342758524526189684048,-0.741531185599394439863864773281,-0.405845151377397166906606412077,&
                0.0,0.405845151377397166906606412077,0.741531185599394439863864773281,0.949107912342758524526189684048/)
            case(8)
                gpy=(/-0.960289856497536231683560868569,-0.796666477413626739591553936476,-0.525532409916328985817739049189,&
                -0.183434642495649804939476142360,0.183434642495649804939476142360,0.525532409916328985817739049189,&
                0.796666477413626739591553936476,0.960289856497536231683560868569/)
            case(9)
                gpy=(/-0.968160239507626089835576202904,-0.836031107326635794299429788070,-0.613371432700590397308702039341,&
                -0.324253423403808929038538014643,0.0,0.324253423403808929038538014643,0.613371432700590397308702039341,&
                0.836031107326635794299429788070,0.968160239507626089835576202904/)
            case(10)
                gpy=(/-0.973906528517171720077964012084,-0.865063366688984510732096688423,-0.679409568299024406234327365115,&
                -0.433395394129247190799265943166,-0.148874338981631210884626001130,0.148874338981631210884626001130,&
                0.433395394129247190799265943166,0.679409568299024406234327365115,0.865063366688984510732096688423,&
                0.973906528517171720077964012084/)
        end select

        select case(i_gpz)
            case(2)
                gpz=(/-0.577350269189625764509148780502,0.577350269189625764509148780502/)
            case(3)
                gpz=(/-0.774596669241483377035853079956,0.0,0.774596669241483377035853079956/)
            case(4)
                gpz=(/-0.861136311594052575223946488893,-0.339981043584856264802665759103,0.339981043584856264802665759103,&
                0.861136311594052575223946488893/)
            case(5)
                gpz=(/-0.906179845938663992797626878299,-0.538469310105683091036314420700,0.0,0.538469310105683091036314420700,&
                0.906179845938663992797626878299/)
            case(6)
                gpz=(/-0.932469514203152027812301554494,-0.661209386466264513661399595020,-0.238619186083196908630501721681,&
                0.238619186083196908630501721681,0.661209386466264513661399595020,0.932469514203152027812301554494/)
            case(7)
                gpz=(/-0.949107912342758524526189684048,-0.741531185599394439863864773281,-0.405845151377397166906606412077,&
                0.0,0.405845151377397166906606412077,0.741531185599394439863864773281,0.949107912342758524526189684048/)
            case(8)
                gpz=(/-0.960289856497536231683560868569,-0.796666477413626739591553936476,-0.525532409916328985817739049189,&
                -0.183434642495649804939476142360,0.183434642495649804939476142360,0.525532409916328985817739049189,&
                0.796666477413626739591553936476,0.960289856497536231683560868569/)
            case(9)
                gpz=(/-0.968160239507626089835576202904,-0.836031107326635794299429788070,-0.613371432700590397308702039341,&
                -0.324253423403808929038538014643,0.0,0.324253423403808929038538014643,0.613371432700590397308702039341,&
                0.836031107326635794299429788070,0.968160239507626089835576202904/)
            case(10)
                gpz=(/-0.973906528517171720077964012084,-0.865063366688984510732096688423,-0.679409568299024406234327365115,&
                -0.433395394129247190799265943166,-0.148874338981631210884626001130,0.148874338981631210884626001130,&
                0.433395394129247190799265943166,0.679409568299024406234327365115,0.865063366688984510732096688423,&
                0.973906528517171720077964012084/)
        end select

    end subroutine get_intpoints
!--------------------------------------------------------------------------------
!--------------get local integration weights-------------------------------------
!--------------------------------------------------------------------------------
    subroutine get_intweights()

        wgx(1:i_gpx)=0.d0; wgy(1:i_gpy)=0.d0; wgz(1:i_gpz)=0.d0
        select case(i_gpx)
            case(2)
                wgx=(/1.d0,1.d0/)
            case(3)
                wgx=(/0.555555555555555555555555555556,0.888888888888888888888888888889,0.555555555555555555555555555556/)
            case(4)
                wgx=(/0.347854845137453857373063949222,0.652145154862546142626936050778,0.652145154862546142626936050778,&
                0.347854845137453857373063949222/)
            case(5)
                wgx=(/0.236926885056189087514264040720,0.478628670499366468041291514836,0.568888888888888888888888888889,&
                0.478628670499366468041291514836,0.236926885056189087514264040720/)
            case(6)
                wgx=(/0.171324492379170345040296142173,0.360761573048138607569833513838,0.467913934572691047389870343990,&
                0.467913934572691047389870343990,0.360761573048138607569833513838,0.171324492379170345040296142173/)
            case(7)
                wgx=(/0.129484966168869693270611432679,0.279705391489276667901467771424,0.381830050505118944950369775489,&
                0.417959183673469387755102040816,0.381830050505118944950369775489,0.279705391489276667901467771424,&
                0.129484966168869693270611432679/)
            case(8)
                wgx=(/0.101228536290376259152531354310,0.222381034453374470544355994426,0.313706645877887287337962201987,&
                0.36268378337836198297,0.362683783378361982965150449277,0.313706645877887287337962201987,&
                0.222381034453374470544355994426,0.101228536290376259152531354310/)
            case(9)
                wgx=(/0.0812743883615744119718921581105,0.180648160694857404058472031243,0.260610696402935462318742869419,&
                0.312347077040002840068630406584,0.330239355001259763164525069287,0.312347077040002840068630406584,&
                0.260610696402935462318742869419,0.180648160694857404058472031243,0.0812743883615744119718921581105/)
            case(10)
                wgx=(/0.0666713443086881375935688098933,0.149451349150580593145776339658,0.219086362515982043995534934228,&
                0.269266719309996355091226921569,0.295524224714752870173892994651,0.295524224714752870173892994651,&
                0.269266719309996355091226921569,0.219086362515982043995534934228,0.149451349150580593145776339658,&
                0.0666713443086881375935688098933/)
        end select

        select case(i_gpy)
            case(2)
                wgy=(/1.d0,1.d0/)
            case(3)
                wgy=(/0.555555555555555555555555555556,0.888888888888888888888888888889,0.555555555555555555555555555556/)
            case(4)
                wgy=(/0.347854845137453857373063949222,0.652145154862546142626936050778,0.652145154862546142626936050778,&
                0.347854845137453857373063949222/)
            case(5)
                wgy=(/0.236926885056189087514264040720,0.478628670499366468041291514836,0.568888888888888888888888888889,&
                0.478628670499366468041291514836,0.236926885056189087514264040720/)
            case(6)
                wgy=(/0.171324492379170345040296142173,0.360761573048138607569833513838,0.467913934572691047389870343990,&
                0.467913934572691047389870343990,0.360761573048138607569833513838,0.171324492379170345040296142173/)
            case(7)
                wgy=(/0.129484966168869693270611432679,0.279705391489276667901467771424,0.381830050505118944950369775489,&
                0.417959183673469387755102040816,0.381830050505118944950369775489,0.279705391489276667901467771424,&
                0.129484966168869693270611432679/)
            case(8)
                wgy=(/0.101228536290376259152531354310,0.222381034453374470544355994426,0.313706645877887287337962201987,&
                0.36268378337836198297,0.362683783378361982965150449277,0.313706645877887287337962201987,&
                0.222381034453374470544355994426,0.101228536290376259152531354310/)
            case(9)
                wgy=(/0.0812743883615744119718921581105,0.180648160694857404058472031243,0.260610696402935462318742869419,&
                0.312347077040002840068630406584,0.330239355001259763164525069287,0.312347077040002840068630406584,&
                0.260610696402935462318742869419,0.180648160694857404058472031243,0.0812743883615744119718921581105/)
            case(10)
                wgy=(/0.0666713443086881375935688098933,0.149451349150580593145776339658,0.219086362515982043995534934228,&
                0.269266719309996355091226921569,0.295524224714752870173892994651,0.295524224714752870173892994651,&
                0.269266719309996355091226921569,0.219086362515982043995534934228,0.149451349150580593145776339658,&
                0.0666713443086881375935688098933/)
        end select

        select case(i_gpz)
            case(2)
                wgz=(/1.d0,1.d0/)
            case(3)
                wgz=(/0.555555555555555555555555555556,0.888888888888888888888888888889,0.555555555555555555555555555556/)
            case(4)
                wgz=(/0.347854845137453857373063949222,0.652145154862546142626936050778,0.652145154862546142626936050778,&
                0.347854845137453857373063949222/)
            case(5)
                wgz=(/0.236926885056189087514264040720,0.478628670499366468041291514836,0.568888888888888888888888888889,&
                0.478628670499366468041291514836,0.236926885056189087514264040720/)
            case(6)
                wgz=(/0.171324492379170345040296142173,0.360761573048138607569833513838,0.467913934572691047389870343990,&
                0.467913934572691047389870343990,0.360761573048138607569833513838,0.171324492379170345040296142173/)
            case(7)
                wgz=(/0.129484966168869693270611432679,0.279705391489276667901467771424,0.381830050505118944950369775489,&
                0.417959183673469387755102040816,0.381830050505118944950369775489,0.279705391489276667901467771424,&
                0.129484966168869693270611432679/)
            case(8)
                wgz=(/0.101228536290376259152531354310,0.222381034453374470544355994426,0.313706645877887287337962201987,&
                0.36268378337836198297,0.362683783378361982965150449277,0.313706645877887287337962201987,&
                0.222381034453374470544355994426,0.101228536290376259152531354310/)
            case(9)
                wgz=(/0.0812743883615744119718921581105,0.180648160694857404058472031243,0.260610696402935462318742869419,&
                0.312347077040002840068630406584,0.330239355001259763164525069287,0.312347077040002840068630406584,&
                0.260610696402935462318742869419,0.180648160694857404058472031243,0.0812743883615744119718921581105/)
            case(10)
                wgz=(/0.0666713443086881375935688098933,0.149451349150580593145776339658,0.219086362515982043995534934228,&
                0.269266719309996355091226921569,0.295524224714752870173892994651,0.295524224714752870173892994651,&
                0.269266719309996355091226921569,0.219086362515982043995534934228,0.149451349150580593145776339658,&
                0.0666713443086881375935688098933/)
        end select
    end subroutine get_intweights
end module integration
